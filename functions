
# the array we predicted
array = forecast_prediction
print('array: ', array)
print(array.shape)
# our true values
true_array = df['Real Prices'].iloc[-(forecast_out+1):]
true_array = true_array.values
print('true array: ', true_array)
print(true_array.shape)
# initial invest moneys
init_invest = 10000
invest = 10000
# initializing the counter i to keep track of the elements in our array for indexing
i = 1

# initializing the number of stocks we own in array format to keep track of our stocks
n = np.zeros(len(array)-1)

# initializing array of zeros to hold value of our stock holdings
holdings = np.zeros(len(array)-1)  # the monetary stock we bought based on our prediction (for n value)
# initialized as an empty array

# initializing value of cost of making a trade
m = 8.9

# initializing array with money value
money = np.zeros(len(array)-1)
money[0] = init_invest
print('money: ', money)

for x in range(1, len(array)-1):

    order = array[x+1] - array[x]
    print('#########################')
    print('order: ', order)
    print('money: ', money[x-1])


    # buy order condition (need at least 500 to invest and must predict that stock will increase)
    if ((money[x-1]) >= 500 and order > 0):
        print('buy')
        if x ==0:
            x = 1
        # creating value for number of stocks to buy
        n[x] = math.floor((money[x-1]) / true_array[x])  # buy number of stocks based on our predicted value
        # calculate the actual value of stocks being bought (must use real price of stock)
        print('n: ', n[x])
        buy = float(n[x] * true_array[x])
        print('true array: ', true_array)
        print('bought: ', buy)
        # subtract amount paid from our money funds (subtract amount of stock bought and amount paid to execute transaction)
        money[x] = money[x-1] - buy
        # stock holdings value (add new holds to previous holdings)
        holdings[x] = holdings[x-1] + buy
    elif (money[x]<500 and order >= 0):
        print('hold')
        # record the value of our holdings
        if x ==0:
            x = 1
        holdings[x] = n[x-1] * true_array[x]
        # record the amount of stocks we are currently holding (this number has not changed from previous day)
        n[x] = n[x - 1]
        # record the amount of leftover money
        money[x] = money[x - 1]
    elif (order < 0):
        print('sell')
        if x ==0:
            x = 1
        # value of stock holdings goes to zero since we are selling all
        holdings[x] = 0
        # value of stocks we are currently holding also goes to 0
        n[x] = 0
        # record the amount of money we have "leftover"
        money[x] = (holdings[x-1]) + money[x-1]
    elif (array[i] == array[i-1]):
        print('hold')
        if x ==0:
            x = 1
        money[x] = money[x-1]
        n[x] = n[x-1]
        holdings = holdings[x-1]

    # use i as a counter
    i += 1

    print('stock holdings: ', holdings[x])
    print('stocks held: ', n[x])
    print('money left: ', money[x])

result = holdings[-1] + money[-1]
percent_return = ((result - init_invest)/init_invest)*100
print(result)
print(percent_return)
portfolio_value = holdings + money
print('portfolio: ', portfolio_value)
